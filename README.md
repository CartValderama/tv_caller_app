# TV Caller App ğŸ“

An Android TV application for managing contacts and making calls with intelligent quick dial based on your call history.

![Version](https://img.shields.io/badge/version-2.0.0-blue)
![Status](https://img.shields.io/badge/status-ready--for--testing-orange)
![Platform](https://img.shields.io/badge/platform-Android%20TV-green)

---

## ğŸ“± What is TV Caller App?

TV Caller is a contact management and calling application designed specifically for Android TV. Navigate with your TV remote's D-pad to manage contacts, view call history, and quickly dial your most frequent contacts.

### Key Features

âœ… **Smart Quick Dial** - Automatically shows your top 4 most contacted people
âœ… **Full Contact Management** - Add, edit, view, and delete contacts
âœ… **Contact Details** - View individual contact info with call history
âœ… **Dial Pad** - Manual phone number entry with numeric keypad
âœ… **User Authentication** - Secure login and registration with email verification
âœ… **Multi-User Support** - Each user sees only their own contacts and data
âœ… **TV Optimized** - Full D-pad navigation, focus states, and TV-friendly UI

### Technology

- **Platform:** Android TV (SDK 21+)
- **Language:** Kotlin
- **Architecture:** MVVM (Model-View-ViewModel)
- **Backend:** Supabase (PostgreSQL + Authentication)
- **Security:** Encrypted session storage, Row Level Security (RLS)

---

## ğŸš¦ Current Status

### âœ… Completed (v2.0.0)
- User authentication (email/password with verification)
- Secure session management with encryption
- Full CRUD contact operations
- Intelligent quick dial algorithm
- Multi-user data isolation with Row Level Security
- Contact pagination (3 per page)
- Call history tracking
- Responsive TV UI with D-pad navigation

### ğŸš§ Known Limitations
- **Calling:** Buttons show toast messages (Android Telecom API not implemented yet)
- **Password Reset:** UI not implemented (backend ready)
- **Contact Search:** Not yet implemented
- **Free Tier:** Using Supabase free tier (leaked password protection unavailable)

### ğŸ”œ Planned Features
- Actual phone calling via Android Telecom API
- Contact search and filtering
- Password reset UI
- Manual quick dial pinning
- Contact sync with device contacts

---

## ğŸš€ Setup Instructions

### Prerequisites

- **Android Studio** (Arctic Fox or later)
- **JDK** 11+
- **Android SDK** 21+ (Lollipop)
- **Supabase Account** (free tier works)

### Step 1: Clone the Repository

```bash
git clone <your-repo-url>
cd TV_caller_app
```

### Step 2: Create Supabase Project

1. Go to [supabase.com](https://supabase.com) and create an account
2. Create a new project
3. Wait for the project to be ready (~2 minutes)
4. Go to **Settings â†’ API**
5. Copy your **Project URL** and **anon/public key**

### Step 3: Configure Credentials

Create a `local.properties` file in the project root:

```bash
cp local.properties.example local.properties
```

Edit `local.properties` and add your Supabase credentials:

```properties
# Android SDK location (auto-generated by Android Studio)
sdk.dir=/path/to/your/android/sdk

# Supabase Configuration
supabase.url=https://your-project-id.supabase.co
supabase.key=your-anon-key-here
```

**âš ï¸ Important:** Never commit `local.properties` to git! It's already in `.gitignore`.

### Step 4: Set Up Database

The app requires these tables in your Supabase database. Run this SQL in the **Supabase SQL Editor**:

```sql
-- Enable UUID extension
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

-- Profiles table (auto-created on user signup)
CREATE TABLE profiles (
  id UUID PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
  username TEXT UNIQUE,
  full_name TEXT,
  phone_number TEXT,
  created_at TIMESTAMPTZ DEFAULT now(),
  updated_at TIMESTAMPTZ DEFAULT now()
);

-- Contacts table
CREATE TABLE contacts (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
  name TEXT NOT NULL,
  phone_number TEXT NOT NULL,
  email TEXT,
  address TEXT,
  notes TEXT,
  is_favorite BOOLEAN DEFAULT false,
  created_at TIMESTAMPTZ DEFAULT now(),
  updated_at TIMESTAMPTZ DEFAULT now()
);

-- Call history table
CREATE TABLE call_history (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
  contact_id UUID REFERENCES contacts(id) ON DELETE SET NULL,
  phone_number TEXT NOT NULL,
  contact_name TEXT,
  call_type TEXT CHECK (call_type IN ('incoming', 'outgoing', 'missed')),
  call_duration INTEGER DEFAULT 0,
  call_timestamp TIMESTAMPTZ DEFAULT now(),
  notes TEXT,
  created_at TIMESTAMPTZ DEFAULT now()
);

-- Quick dial table (for future manual pinning feature)
CREATE TABLE quick_dial (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
  contact_id UUID REFERENCES contacts(id) ON DELETE CASCADE,
  position INTEGER NOT NULL,
  created_at TIMESTAMPTZ DEFAULT now()
);

-- Auto-create profile when user signs up
CREATE OR REPLACE FUNCTION public.handle_new_user()
RETURNS TRIGGER
SECURITY DEFINER
SET search_path = public
AS $$
BEGIN
  INSERT INTO public.profiles (id, username, created_at)
  VALUES (
    NEW.id,
    SPLIT_PART(NEW.email, '@', 1),
    NOW()
  );
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER on_auth_user_created
  AFTER INSERT ON auth.users
  FOR EACH ROW
  EXECUTE FUNCTION public.handle_new_user();

-- Enable Row Level Security
ALTER TABLE profiles ENABLE ROW LEVEL SECURITY;
ALTER TABLE contacts ENABLE ROW LEVEL SECURITY;
ALTER TABLE call_history ENABLE ROW LEVEL SECURITY;
ALTER TABLE quick_dial ENABLE ROW LEVEL SECURITY;

-- RLS Policies for profiles
CREATE POLICY "profiles_select_policy" ON profiles FOR SELECT USING ((select auth.uid()) = id);
CREATE POLICY "profiles_update_policy" ON profiles FOR UPDATE USING ((select auth.uid()) = id);
CREATE POLICY "profiles_insert_policy" ON profiles FOR INSERT WITH CHECK ((select auth.uid()) = id);

-- RLS Policies for contacts
CREATE POLICY "contacts_select_policy" ON contacts FOR SELECT USING ((select auth.uid()) = user_id);
CREATE POLICY "contacts_insert_policy" ON contacts FOR INSERT WITH CHECK ((select auth.uid()) = user_id);
CREATE POLICY "contacts_update_policy" ON contacts FOR UPDATE USING ((select auth.uid()) = user_id);
CREATE POLICY "contacts_delete_policy" ON contacts FOR DELETE USING ((select auth.uid()) = user_id);

-- RLS Policies for call_history
CREATE POLICY "call_history_select_policy" ON call_history FOR SELECT USING ((select auth.uid()) = user_id);
CREATE POLICY "call_history_insert_policy" ON call_history FOR INSERT WITH CHECK ((select auth.uid()) = user_id);
CREATE POLICY "call_history_update_policy" ON call_history FOR UPDATE USING ((select auth.uid()) = user_id);
CREATE POLICY "call_history_delete_policy" ON call_history FOR DELETE USING ((select auth.uid()) = user_id);

-- RLS Policies for quick_dial
CREATE POLICY "quick_dial_select_policy" ON quick_dial FOR SELECT USING ((select auth.uid()) = user_id);
CREATE POLICY "quick_dial_insert_policy" ON quick_dial FOR INSERT WITH CHECK ((select auth.uid()) = user_id);
CREATE POLICY "quick_dial_update_policy" ON quick_dial FOR UPDATE USING ((select auth.uid()) = user_id);
CREATE POLICY "quick_dial_delete_policy" ON quick_dial FOR DELETE USING ((select auth.uid()) = user_id);
```

### Step 5: Enable Email Authentication in Supabase

1. In your Supabase project, go to **Authentication â†’ Providers**
2. Make sure **Email** is enabled
3. Configure email settings:
   - **Enable email confirmations** (recommended)
   - **Disable email signups** if you want invite-only

### Step 6: Build and Run

#### Option A: Using Android Studio
1. Open the project in Android Studio
2. Wait for Gradle sync to complete
3. Select an Android TV emulator or device
4. Click **Run** â–¶ï¸ or press `Shift+F10`

#### Option B: Using Command Line
```bash
# Build the app
./gradlew assembleDebug

# Install on connected device
./gradlew installDebug
```

### Step 7: First Launch

1. The app will open to the **Login Screen**
2. Click **"Don't have an account? Register"**
3. Enter your email and password (must meet requirements)
4. Check your email for the verification link
5. Click the verification link
6. Return to the app and login
7. Start adding contacts!

---

## ğŸ“– How to Use

### Register & Login
1. Register with your email and strong password
2. Verify your email (check inbox/spam)
3. Login with your credentials

### Managing Contacts
- **Add Contact:** Go to "Contacts" tab â†’ Press OK on "+" button â†’ Fill form â†’ Save
- **View Contact:** Select any contact to see details
- **Edit Contact:** Open contact â†’ Press "Edit" button â†’ Modify â†’ Save
- **Delete Contact:** Open contact â†’ Press "Delete" â†’ Confirm

### Quick Dial
- The **Quick Dial** tab automatically shows your top 4 most contacted people
- Algorithm considers call frequency, recency, and call type (outgoing > incoming > missed)

### Dial Pad
- Use the **Dial Pad** tab to manually enter phone numbers
- Press number buttons or type with keyboard
- Press the green call button (currently shows a toast)

### Logout
- Click the **Logout** button in the top right corner
- Confirm logout

---

## ğŸ® TV Remote Navigation

| Button | Action |
|--------|--------|
| **D-Pad â†‘â†“â†â†’** | Navigate between UI elements |
| **Center/OK** | Select item or press button |
| **Back** | Go to previous screen |
| **Home** | Exit to Android TV launcher |

---

## ğŸ”’ Security & Privacy

- **Encrypted Storage:** Session tokens stored with AES256_GCM encryption
- **Email Verification:** Required before account activation
- **Row Level Security:** Database enforces data isolation between users
- **Password Requirements:** 8+ characters, uppercase, lowercase, number, special character
- **Multi-User Isolation:** Users can only see their own data

---

## ğŸ› Troubleshooting

### "SUPABASE_URL not found" error
1. Make sure `local.properties` exists
2. Verify `supabase.url` and `supabase.key` are set
3. Sync Gradle: `File â†’ Sync Project with Gradle Files`

### Build fails after adding credentials
```bash
./gradlew clean
# Then rebuild in Android Studio
```

### Login not working
- Check email is verified (click link in verification email)
- Verify Supabase Email provider is enabled
- Check password meets requirements (8+ chars, upper, lower, number, special)

### Can't see contacts from other devices
- This is by design! Each user sees only their own contacts
- Make sure you're logged in with the same account

### App crashes on startup
```bash
# Clear app data
adb shell pm clear com.example.tv_caller_app
# Then restart the app
```

---

## ğŸ“ Project Structure

```
app/src/main/java/com/example/tv_caller_app/
â”œâ”€â”€ auth/              # SessionManager (encrypted storage)
â”œâ”€â”€ model/             # Data classes (Contact, Profile, etc.)
â”œâ”€â”€ network/           # SupabaseClient configuration
â”œâ”€â”€ repository/        # Data access layer (Singletons)
â”œâ”€â”€ ui/
â”‚   â”œâ”€â”€ activities/    # MainActivity, AuthActivity
â”‚   â”œâ”€â”€ adapters/      # RecyclerView adapters
â”‚   â””â”€â”€ fragments/     # All UI fragments
â””â”€â”€ viewmodel/         # ViewModels (MVVM pattern)
```

---

## ğŸ› ï¸ Built With

- **Kotlin** - Programming language
- **Android Leanback** - TV UI components
- **Supabase** - Backend (PostgreSQL + Auth)
- **Ktor** - HTTP client
- **Coroutines** - Asynchronous programming
- **ViewModel & LiveData** - MVVM architecture
- **EncryptedSharedPreferences** - Secure storage

---

## ğŸ“ License

[Add your license here]

---

## ğŸ‘¤ Author

[Add your name/contact here]

---

## ğŸ™ Acknowledgments

- Android Leanback library for TV UI
- Supabase for backend infrastructure
- Material Design for icons

---

**Version:** 2.0.0
**Status:** Ready for testing
**Last Updated:** January 2025
